"use strict";
const assert_1 = require("@aws-cdk/assert");
const ec2 = require("@aws-cdk/aws-ec2");
const cdk = require("@aws-cdk/cdk");
const servicediscovery = require("../lib");
module.exports = {
    'Service for HTTP namespace with custom health check'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.HttpNamespace(stack, 'MyNamespace', {
            name: 'http',
        });
        namespace.createService('MyService', {
            name: 'service',
            description: 'service description',
            customHealthCheck: {
                failureThreshold: 3,
            }
        });
        // THEN
        assert_1.expect(stack).toMatch({
            Resources: {
                MyNamespaceD0BB8558: {
                    Type: "AWS::ServiceDiscovery::HttpNamespace",
                    Properties: {
                        Name: "http"
                    },
                },
                MyNamespaceMyService365E2470: {
                    Type: "AWS::ServiceDiscovery::Service",
                    Properties: {
                        Description: "service description",
                        HealthCheckCustomConfig: {
                            FailureThreshold: 3,
                        },
                        Name: "service",
                        NamespaceId: {
                            "Fn::GetAtt": [
                                "MyNamespaceD0BB8558",
                                "Id"
                            ]
                        }
                    }
                }
            }
        });
        test.done();
    },
    'Service for HTTP namespace with health check'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.HttpNamespace(stack, 'MyNamespace', {
            name: 'http',
        });
        namespace.createService('MyService', {
            name: 'service',
            description: 'service description',
            healthCheck: {
                type: servicediscovery.HealthCheckType.Http,
                resourcePath: '/check'
            }
        });
        // THEN
        assert_1.expect(stack).toMatch({
            Resources: {
                MyNamespaceD0BB8558: {
                    Type: "AWS::ServiceDiscovery::HttpNamespace",
                    Properties: {
                        Name: "http"
                    },
                },
                MyNamespaceMyService365E2470: {
                    Type: "AWS::ServiceDiscovery::Service",
                    Properties: {
                        Description: "service description",
                        HealthCheckConfig: {
                            FailureThreshold: 1,
                            ResourcePath: "/check",
                            Type: "HTTP"
                        },
                        Name: "service",
                        NamespaceId: {
                            "Fn::GetAtt": [
                                "MyNamespaceD0BB8558",
                                "Id"
                            ]
                        }
                    }
                }
            }
        });
        test.done();
    },
    'Service for Public DNS namespace'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'dns',
        });
        namespace.createService('MyService', {
            name: 'service',
            description: 'service description',
            customHealthCheck: {
                failureThreshold: 3,
            }
        });
        // THEN
        assert_1.expect(stack).toMatch({
            Resources: {
                MyNamespaceD0BB8558: {
                    Type: "AWS::ServiceDiscovery::PublicDnsNamespace",
                    Properties: {
                        Name: "dns"
                    }
                },
                MyNamespaceMyService365E2470: {
                    Type: "AWS::ServiceDiscovery::Service",
                    Properties: {
                        Description: "service description",
                        DnsConfig: {
                            DnsRecords: [
                                {
                                    TTL: 60,
                                    Type: "A"
                                }
                            ],
                            NamespaceId: {
                                "Fn::GetAtt": [
                                    "MyNamespaceD0BB8558",
                                    "Id"
                                ]
                            },
                            RoutingPolicy: "MULTIVALUE"
                        },
                        HealthCheckCustomConfig: {
                            FailureThreshold: 3
                        },
                        Name: "service",
                        NamespaceId: {
                            "Fn::GetAtt": [
                                "MyNamespaceD0BB8558",
                                "Id"
                            ]
                        }
                    }
                }
            }
        });
        test.done();
    },
    'Service for Public DNS namespace with A and AAAA records'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'dns',
        });
        namespace.createService('MyService', {
            dnsRecordType: servicediscovery.DnsRecordType.A_AAAA
        });
        // THEN
        assert_1.expect(stack).toMatch({
            Resources: {
                MyNamespaceD0BB8558: {
                    Type: "AWS::ServiceDiscovery::PublicDnsNamespace",
                    Properties: {
                        Name: "dns"
                    }
                },
                MyNamespaceMyService365E2470: {
                    Type: "AWS::ServiceDiscovery::Service",
                    Properties: {
                        DnsConfig: {
                            DnsRecords: [
                                {
                                    TTL: 60,
                                    Type: "A"
                                },
                                {
                                    TTL: 60,
                                    Type: "AAAA"
                                }
                            ],
                            NamespaceId: {
                                "Fn::GetAtt": [
                                    "MyNamespaceD0BB8558",
                                    "Id"
                                ]
                            },
                            RoutingPolicy: "MULTIVALUE",
                        },
                        NamespaceId: {
                            "Fn::GetAtt": [
                                "MyNamespaceD0BB8558",
                                "Id"
                            ]
                        }
                    }
                }
            }
        });
        test.done();
    },
    'Defaults to WEIGHTED routing policy for CNAME'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'dns',
        });
        namespace.createService('MyService', {
            dnsRecordType: servicediscovery.DnsRecordType.CNAME
        });
        // THEN
        assert_1.expect(stack).toMatch({
            Resources: {
                MyNamespaceD0BB8558: {
                    Type: "AWS::ServiceDiscovery::PublicDnsNamespace",
                    Properties: {
                        Name: "dns"
                    }
                },
                MyNamespaceMyService365E2470: {
                    Type: "AWS::ServiceDiscovery::Service",
                    Properties: {
                        DnsConfig: {
                            DnsRecords: [
                                {
                                    TTL: 60,
                                    Type: "CNAME"
                                }
                            ],
                            NamespaceId: {
                                "Fn::GetAtt": [
                                    "MyNamespaceD0BB8558",
                                    "Id"
                                ]
                            },
                            RoutingPolicy: "WEIGHTED",
                        },
                        NamespaceId: {
                            "Fn::GetAtt": [
                                "MyNamespaceD0BB8558",
                                "Id"
                            ]
                        }
                    }
                }
            }
        });
        test.done();
    },
    'Throws when specifying both healthCheckConfig and healthCheckCustomConfig on PublicDnsNamespace'(test) {
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'name',
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                name: 'service',
                healthCheck: {
                    resourcePath: '/'
                },
                customHealthCheck: {
                    failureThreshold: 1
                }
            });
        }, /`healthCheckConfig`.+`healthCheckCustomConfig`/);
        test.done();
    },
    'Throws when specifying healthCheckConfig on PrivateDnsNamespace'(test) {
        const stack = new cdk.Stack();
        const vpc = new ec2.VpcNetwork(stack, 'MyVpc');
        const namespace = new servicediscovery.PrivateDnsNamespace(stack, 'MyNamespace', {
            name: 'name',
            vpc
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                name: 'service',
                healthCheck: {
                    resourcePath: '/'
                },
                customHealthCheck: {
                    failureThreshold: 1
                }
            });
        }, /`healthCheckConfig`.+`healthCheckCustomConfig`/);
        test.done();
    },
    'Throws when using CNAME and Multivalue routing policy'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'name',
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                name: 'service',
                dnsRecordType: servicediscovery.DnsRecordType.CNAME,
                routingPolicy: servicediscovery.RoutingPolicy.Multivalue,
            });
        }, /Cannot use `CNAME` record when routing policy is `Multivalue`./);
        test.done();
    },
    'Throws when specifying resourcePath with TCP'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'name',
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                name: 'service',
                healthCheck: {
                    type: servicediscovery.HealthCheckType.Tcp,
                    resourcePath: '/check'
                }
            });
        }, /`resourcePath`.+`TCP`/);
        test.done();
    },
    'Throws when specifying loadbalancer with wrong DnsRecordType'(test) {
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'name',
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                name: 'service',
                dnsRecordType: servicediscovery.DnsRecordType.CNAME,
                loadBalancer: true
            });
        }, /Must support `A` or `AAAA` records to register loadbalancers/);
        test.done();
    },
    'Throws when specifying loadbalancer with Multivalue routing Policy'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const namespace = new servicediscovery.PublicDnsNamespace(stack, 'MyNamespace', {
            name: 'http',
        });
        // THEN
        test.throws(() => {
            namespace.createService('MyService', {
                loadBalancer: true,
                routingPolicy: servicediscovery.RoutingPolicy.Multivalue
            });
        }, /Cannot register loadbalancers when routing policy is `Multivalue`./);
        test.done();
    },
    'Service for Private DNS namespace'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        const vpc = new ec2.VpcNetwork(stack, 'MyVpc');
        const namespace = new servicediscovery.PrivateDnsNamespace(stack, 'MyNamespace', {
            name: 'private',
            vpc
        });
        namespace.createService('MyService', {
            name: 'service',
            description: 'service description',
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResource('AWS::ServiceDiscovery::PrivateDnsNamespace', {
            Name: "private"
        }));
        assert_1.expect(stack).to(assert_1.haveResource('AWS::ServiceDiscovery::Service', {
            Description: "service description",
            DnsConfig: {
                DnsRecords: [
                    {
                        TTL: 60,
                        Type: "A"
                    }
                ],
                NamespaceId: {
                    "Fn::GetAtt": [
                        "MyNamespaceD0BB8558",
                        "Id"
                    ]
                },
                RoutingPolicy: "MULTIVALUE"
            },
            Name: "service",
            NamespaceId: {
                "Fn::GetAtt": [
                    "MyNamespaceD0BB8558",
                    "Id"
                ]
            }
        }));
        test.done();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw0Q0FBdUQ7QUFDdkQsd0NBQXlDO0FBQ3pDLG9DQUFxQztBQUVyQywyQ0FBNEM7QUFFNUMsaUJBQVM7SUFDUCxxREFBcUQsQ0FBQyxJQUFVO1FBQzlELFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixNQUFNLFNBQVMsR0FBRyxJQUFJLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFO1lBQ3pFLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQyxDQUFDO1FBRUgsU0FBUyxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUU7WUFDbkMsSUFBSSxFQUFFLFNBQVM7WUFDZixXQUFXLEVBQUUscUJBQXFCO1lBQ2xDLGlCQUFpQixFQUFFO2dCQUNqQixnQkFBZ0IsRUFBRSxDQUFDO2FBQ3BCO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLGVBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDcEIsU0FBUyxFQUFFO2dCQUNULG1CQUFtQixFQUFFO29CQUNuQixJQUFJLEVBQUUsc0NBQXNDO29CQUM1QyxVQUFVLEVBQUU7d0JBQ1YsSUFBSSxFQUFFLE1BQU07cUJBQ2I7aUJBQ0Y7Z0JBQ0QsNEJBQTRCLEVBQUU7b0JBQzVCLElBQUksRUFBRSxnQ0FBZ0M7b0JBQ3RDLFVBQVUsRUFBRTt3QkFDVixXQUFXLEVBQUUscUJBQXFCO3dCQUNsQyx1QkFBdUIsRUFBRTs0QkFDdkIsZ0JBQWdCLEVBQUUsQ0FBQzt5QkFDcEI7d0JBQ0QsSUFBSSxFQUFFLFNBQVM7d0JBQ2YsV0FBVyxFQUFFOzRCQUNYLFlBQVksRUFBRTtnQ0FDWixxQkFBcUI7Z0NBQ3JCLElBQUk7NkJBQ0w7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNG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b0JBQ1oscUJBQXFCO29CQUNyQixJQUFJO2lCQUNMO2FBQ0Y7U0FDRixDQUFDLENBQUMsQ0FBQztRQUVKLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhwZWN0LCBoYXZlUmVzb3VyY2UgfSBmcm9tICdAYXdzLWNkay9hc3NlcnQnO1xuaW1wb3J0IGVjMiA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1lYzInKTtcbmltcG9ydCBjZGsgPSByZXF1aXJlKCdAYXdzLWNkay9jZGsnKTtcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgc2VydmljZWRpc2NvdmVyeSA9IHJlcXVpcmUoJy4uL2xpYicpO1xuXG5leHBvcnQgPSB7XG4gICdTZXJ2aWNlIGZvciBIVFRQIG5hbWVzcGFjZSB3aXRoIGN1c3RvbSBoZWFsdGggY2hlY2snKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuSHR0cE5hbWVzcGFjZShzdGFjaywgJ015TmFtZXNwYWNlJywge1xuICAgICAgbmFtZTogJ2h0dHAnLFxuICAgIH0pO1xuXG4gICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgIG5hbWU6ICdzZXJ2aWNlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnc2VydmljZSBkZXNjcmlwdGlvbicsXG4gICAgICBjdXN0b21IZWFsdGhDaGVjazoge1xuICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiAzLFxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjaykudG9NYXRjaCh7XG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgTXlOYW1lc3BhY2VEMEJCODU1ODoge1xuICAgICAgICAgIFR5cGU6IFwiQVdTOjpTZXJ2aWNlRGlzY292ZXJ5OjpIdHRwTmFtZXNwYWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgTmFtZTogXCJodHRwXCJcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBNeU5hbWVzcGFjZU15U2VydmljZTM2NUUyNDcwOiB7XG4gICAgICAgICAgVHlwZTogXCJBV1M6OlNlcnZpY2VEaXNjb3Zlcnk6OlNlcnZpY2VcIixcbiAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBEZXNjcmlwdGlvbjogXCJzZXJ2aWNlIGRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBIZWFsdGhDaGVja0N1c3RvbUNvbmZpZzoge1xuICAgICAgICAgICAgICBGYWlsdXJlVGhyZXNob2xkOiAzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIE5hbWU6IFwic2VydmljZVwiLFxuICAgICAgICAgICAgTmFtZXNwYWNlSWQ6IHtcbiAgICAgICAgICAgICAgXCJGbjo6R2V0QXR0XCI6IFtcbiAgICAgICAgICAgICAgICBcIk15TmFtZXNwYWNlRDBCQjg1NThcIixcbiAgICAgICAgICAgICAgICBcIklkXCJcbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ1NlcnZpY2UgZm9yIEhUVFAgbmFtZXNwYWNlIHdpdGggaGVhbHRoIGNoZWNrJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IG5ldyBzZXJ2aWNlZGlzY292ZXJ5Lkh0dHBOYW1lc3BhY2Uoc3RhY2ssICdNeU5hbWVzcGFjZScsIHtcbiAgICAgIG5hbWU6ICdodHRwJyxcbiAgICB9KTtcblxuICAgIG5hbWVzcGFjZS5jcmVhdGVTZXJ2aWNlKCdNeVNlcnZpY2UnLCB7XG4gICAgICBuYW1lOiAnc2VydmljZScsXG4gICAgICBkZXNjcmlwdGlvbjogJ3NlcnZpY2UgZGVzY3JpcHRpb24nLFxuICAgICAgaGVhbHRoQ2hlY2s6IHtcbiAgICAgICAgdHlwZTogc2VydmljZWRpc2NvdmVyeS5IZWFsdGhDaGVja1R5cGUuSHR0cCxcbiAgICAgICAgcmVzb3VyY2VQYXRoOiAnL2NoZWNrJ1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjaykudG9NYXRjaCh7XG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgTXlOYW1lc3BhY2VEMEJCODU1ODoge1xuICAgICAgICAgIFR5cGU6IFwiQVdTOjpTZXJ2aWNlRGlzY292ZXJ5OjpIdHRwTmFtZXNwYWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgTmFtZTogXCJodHRwXCJcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBNeU5hbWVzcGFjZU15U2VydmljZTM2NUUyNDcwOiB7XG4gICAgICAgICAgVHlwZTogXCJBV1M6OlNlcnZpY2VEaXNjb3Zlcnk6OlNlcnZpY2VcIixcbiAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBEZXNjcmlwdGlvbjogXCJzZXJ2aWNlIGRlc2NyaXB0aW9uXCIsXG4gICAgICAgICAgICBIZWFsdGhDaGVja0NvbmZpZzoge1xuICAgICAgICAgICAgICBGYWlsdXJlVGhyZXNob2xkOiAxLFxuICAgICAgICAgICAgICBSZXNvdXJjZVBhdGg6IFwiL2NoZWNrXCIsXG4gICAgICAgICAgICAgIFR5cGU6IFwiSFRUUFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgTmFtZTogXCJzZXJ2aWNlXCIsXG4gICAgICAgICAgICBOYW1lc3BhY2VJZDoge1xuICAgICAgICAgICAgICBcIkZuOjpHZXRBdHRcIjogW1xuICAgICAgICAgICAgICAgIFwiTXlOYW1lc3BhY2VEMEJCODU1OFwiLFxuICAgICAgICAgICAgICAgIFwiSWRcIlxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnU2VydmljZSBmb3IgUHVibGljIEROUyBuYW1lc3BhY2UnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnZG5zJyxcbiAgICB9KTtcblxuICAgIG5hbWVzcGFjZS5jcmVhdGVTZXJ2aWNlKCdNeVNlcnZpY2UnLCB7XG4gICAgICBuYW1lOiAnc2VydmljZScsXG4gICAgICBkZXNjcmlwdGlvbjogJ3NlcnZpY2UgZGVzY3JpcHRpb24nLFxuICAgICAgY3VzdG9tSGVhbHRoQ2hlY2s6IHtcbiAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMyxcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2spLnRvTWF0Y2goe1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIE15TmFtZXNwYWNlRDBCQjg1NTg6IHtcbiAgICAgICAgICBUeXBlOiBcIkFXUzo6U2VydmljZURpc2NvdmVyeTo6UHVibGljRG5zTmFtZXNwYWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgTmFtZTogXCJkbnNcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgTXlOYW1lc3BhY2VNeVNlcnZpY2UzNjVFMjQ3MDoge1xuICAgICAgICAgIFR5cGU6IFwiQVdTOjpTZXJ2aWNlRGlzY292ZXJ5OjpTZXJ2aWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgRGVzY3JpcHRpb246IFwic2VydmljZSBkZXNjcmlwdGlvblwiLFxuICAgICAgICAgICAgRG5zQ29uZmlnOiB7XG4gICAgICAgICAgICAgIERuc1JlY29yZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBUVEw6IDYwLFxuICAgICAgICAgICAgICAgICAgVHlwZTogXCJBXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIE5hbWVzcGFjZUlkOiB7XG4gICAgICAgICAgICAgICAgXCJGbjo6R2V0QXR0XCI6IFtcbiAgICAgICAgICAgICAgICAgIFwiTXlOYW1lc3BhY2VEMEJCODU1OFwiLFxuICAgICAgICAgICAgICAgICAgXCJJZFwiXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBSb3V0aW5nUG9saWN5OiBcIk1VTFRJVkFMVUVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEhlYWx0aENoZWNrQ3VzdG9tQ29uZmlnOiB7XG4gICAgICAgICAgICAgIEZhaWx1cmVUaHJlc2hvbGQ6IDNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBOYW1lOiBcInNlcnZpY2VcIixcbiAgICAgICAgICAgIE5hbWVzcGFjZUlkOiB7XG4gICAgICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICAgICAgXCJNeU5hbWVzcGFjZUQwQkI4NTU4XCIsXG4gICAgICAgICAgICAgICAgXCJJZFwiXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdTZXJ2aWNlIGZvciBQdWJsaWMgRE5TIG5hbWVzcGFjZSB3aXRoIEEgYW5kIEFBQUEgcmVjb3JkcycodGVzdDogVGVzdCkge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICBjb25zdCBuYW1lc3BhY2UgPSBuZXcgc2VydmljZWRpc2NvdmVyeS5QdWJsaWNEbnNOYW1lc3BhY2Uoc3RhY2ssICdNeU5hbWVzcGFjZScsIHtcbiAgICAgIG5hbWU6ICdkbnMnLFxuICAgIH0pO1xuXG4gICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgIGRuc1JlY29yZFR5cGU6IHNlcnZpY2VkaXNjb3ZlcnkuRG5zUmVjb3JkVHlwZS5BX0FBQUFcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2spLnRvTWF0Y2goe1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIE15TmFtZXNwYWNlRDBCQjg1NTg6IHtcbiAgICAgICAgICBUeXBlOiBcIkFXUzo6U2VydmljZURpc2NvdmVyeTo6UHVibGljRG5zTmFtZXNwYWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgTmFtZTogXCJkbnNcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgTXlOYW1lc3BhY2VNeVNlcnZpY2UzNjVFMjQ3MDoge1xuICAgICAgICAgIFR5cGU6IFwiQVdTOjpTZXJ2aWNlRGlzY292ZXJ5OjpTZXJ2aWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgRG5zQ29uZmlnOiB7XG4gICAgICAgICAgICAgIERuc1JlY29yZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBUVEw6IDYwLFxuICAgICAgICAgICAgICAgICAgVHlwZTogXCJBXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIFRUTDogNjAsXG4gICAgICAgICAgICAgICAgICBUeXBlOiBcIkFBQUFcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgTmFtZXNwYWNlSWQ6IHtcbiAgICAgICAgICAgICAgICBcIkZuOjpHZXRBdHRcIjogW1xuICAgICAgICAgICAgICAgICAgXCJNeU5hbWVzcGFjZUQwQkI4NTU4XCIsXG4gICAgICAgICAgICAgICAgICBcIklkXCJcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIFJvdXRpbmdQb2xpY3k6IFwiTVVMVElWQUxVRVwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIE5hbWVzcGFjZUlkOiB7XG4gICAgICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICAgICAgXCJNeU5hbWVzcGFjZUQwQkI4NTU4XCIsXG4gICAgICAgICAgICAgICAgXCJJZFwiXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdEZWZhdWx0cyB0byBXRUlHSFRFRCByb3V0aW5nIHBvbGljeSBmb3IgQ05BTUUnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnZG5zJyxcbiAgICB9KTtcblxuICAgIG5hbWVzcGFjZS5jcmVhdGVTZXJ2aWNlKCdNeVNlcnZpY2UnLCB7XG4gICAgICBkbnNSZWNvcmRUeXBlOiBzZXJ2aWNlZGlzY292ZXJ5LkRuc1JlY29yZFR5cGUuQ05BTUVcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2spLnRvTWF0Y2goe1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIE15TmFtZXNwYWNlRDBCQjg1NTg6IHtcbiAgICAgICAgICBUeXBlOiBcIkFXUzo6U2VydmljZURpc2NvdmVyeTo6UHVibGljRG5zTmFtZXNwYWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgTmFtZTogXCJkbnNcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgTXlOYW1lc3BhY2VNeVNlcnZpY2UzNjVFMjQ3MDoge1xuICAgICAgICAgIFR5cGU6IFwiQVdTOjpTZXJ2aWNlRGlzY292ZXJ5OjpTZXJ2aWNlXCIsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgRG5zQ29uZmlnOiB7XG4gICAgICAgICAgICAgIERuc1JlY29yZHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBUVEw6IDYwLFxuICAgICAgICAgICAgICAgICAgVHlwZTogXCJDTkFNRVwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBOYW1lc3BhY2VJZDoge1xuICAgICAgICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICAgICAgICBcIk15TmFtZXNwYWNlRDBCQjg1NThcIixcbiAgICAgICAgICAgICAgICAgIFwiSWRcIlxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgUm91dGluZ1BvbGljeTogXCJXRUlHSFRFRFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIE5hbWVzcGFjZUlkOiB7XG4gICAgICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICAgICAgXCJNeU5hbWVzcGFjZUQwQkI4NTU4XCIsXG4gICAgICAgICAgICAgICAgXCJJZFwiXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdUaHJvd3Mgd2hlbiBzcGVjaWZ5aW5nIGJvdGggaGVhbHRoQ2hlY2tDb25maWcgYW5kIGhlYWx0aENoZWNrQ3VzdG9tQ29uZmlnIG9uIFB1YmxpY0Ruc05hbWVzcGFjZScodGVzdDogVGVzdCkge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnbmFtZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgICAgbmFtZTogJ3NlcnZpY2UnLFxuICAgICAgICBoZWFsdGhDaGVjazoge1xuICAgICAgICAgIHJlc291cmNlUGF0aDogJy8nXG4gICAgICAgIH0sXG4gICAgICAgIGN1c3RvbUhlYWx0aENoZWNrOiB7XG4gICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCAvYGhlYWx0aENoZWNrQ29uZmlnYC4rYGhlYWx0aENoZWNrQ3VzdG9tQ29uZmlnYC8pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ1Rocm93cyB3aGVuIHNwZWNpZnlpbmcgaGVhbHRoQ2hlY2tDb25maWcgb24gUHJpdmF0ZURuc05hbWVzcGFjZScodGVzdDogVGVzdCkge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjTmV0d29yayhzdGFjaywgJ015VnBjJyk7XG5cbiAgICBjb25zdCBuYW1lc3BhY2UgPSBuZXcgc2VydmljZWRpc2NvdmVyeS5Qcml2YXRlRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnbmFtZScsXG4gICAgICB2cGNcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LnRocm93cygoKSA9PiB7XG4gICAgICBuYW1lc3BhY2UuY3JlYXRlU2VydmljZSgnTXlTZXJ2aWNlJywge1xuICAgICAgICBuYW1lOiAnc2VydmljZScsXG4gICAgICAgIGhlYWx0aENoZWNrOiB7XG4gICAgICAgICAgcmVzb3VyY2VQYXRoOiAnLydcbiAgICAgICAgfSxcbiAgICAgICAgY3VzdG9tSGVhbHRoQ2hlY2s6IHtcbiAgICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiAxXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIC9gaGVhbHRoQ2hlY2tDb25maWdgLitgaGVhbHRoQ2hlY2tDdXN0b21Db25maWdgLyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnVGhyb3dzIHdoZW4gdXNpbmcgQ05BTUUgYW5kIE11bHRpdmFsdWUgcm91dGluZyBwb2xpY3knKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnbmFtZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgICAgbmFtZTogJ3NlcnZpY2UnLFxuICAgICAgICBkbnNSZWNvcmRUeXBlOiBzZXJ2aWNlZGlzY292ZXJ5LkRuc1JlY29yZFR5cGUuQ05BTUUsXG4gICAgICAgIHJvdXRpbmdQb2xpY3k6IHNlcnZpY2VkaXNjb3ZlcnkuUm91dGluZ1BvbGljeS5NdWx0aXZhbHVlLFxuICAgICAgfSk7XG4gICAgfSwgL0Nhbm5vdCB1c2UgYENOQU1FYCByZWNvcmQgd2hlbiByb3V0aW5nIHBvbGljeSBpcyBgTXVsdGl2YWx1ZWAuLyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnVGhyb3dzIHdoZW4gc3BlY2lmeWluZyByZXNvdXJjZVBhdGggd2l0aCBUQ1AnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnbmFtZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgICAgbmFtZTogJ3NlcnZpY2UnLFxuICAgICAgICBoZWFsdGhDaGVjazoge1xuICAgICAgICAgIHR5cGU6IHNlcnZpY2VkaXNjb3ZlcnkuSGVhbHRoQ2hlY2tUeXBlLlRjcCxcbiAgICAgICAgICByZXNvdXJjZVBhdGg6ICcvY2hlY2snXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIC9gcmVzb3VyY2VQYXRoYC4rYFRDUGAvKTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdUaHJvd3Mgd2hlbiBzcGVjaWZ5aW5nIGxvYWRiYWxhbmNlciB3aXRoIHdyb25nIERuc1JlY29yZFR5cGUnKHRlc3Q6IFRlc3QpIHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IG5ldyBzZXJ2aWNlZGlzY292ZXJ5LlB1YmxpY0Ruc05hbWVzcGFjZShzdGFjaywgJ015TmFtZXNwYWNlJywge1xuICAgICAgbmFtZTogJ25hbWUnLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QudGhyb3dzKCgpID0+IHtcbiAgICAgIG5hbWVzcGFjZS5jcmVhdGVTZXJ2aWNlKCdNeVNlcnZpY2UnLCB7XG4gICAgICAgIG5hbWU6ICdzZXJ2aWNlJyxcbiAgICAgICAgZG5zUmVjb3JkVHlwZTogc2VydmljZWRpc2NvdmVyeS5EbnNSZWNvcmRUeXBlLkNOQU1FLFxuICAgICAgICBsb2FkQmFsYW5jZXI6IHRydWVcbiAgICAgIH0pO1xuICAgIH0sIC9NdXN0IHN1cHBvcnQgYEFgIG9yIGBBQUFBYCByZWNvcmRzIHRvIHJlZ2lzdGVyIGxvYWRiYWxhbmNlcnMvKTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdUaHJvd3Mgd2hlbiBzcGVjaWZ5aW5nIGxvYWRiYWxhbmNlciB3aXRoIE11bHRpdmFsdWUgcm91dGluZyBQb2xpY3knKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHVibGljRG5zTmFtZXNwYWNlKHN0YWNrLCAnTXlOYW1lc3BhY2UnLCB7XG4gICAgICBuYW1lOiAnaHR0cCcsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgICAgbG9hZEJhbGFuY2VyOiB0cnVlLFxuICAgICAgICByb3V0aW5nUG9saWN5OiBzZXJ2aWNlZGlzY292ZXJ5LlJvdXRpbmdQb2xpY3kuTXVsdGl2YWx1ZVxuICAgICAgfSk7XG4gICAgfSwgL0Nhbm5vdCByZWdpc3RlciBsb2FkYmFsYW5jZXJzIHdoZW4gcm91dGluZyBwb2xpY3kgaXMgYE11bHRpdmFsdWVgLi8pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ1NlcnZpY2UgZm9yIFByaXZhdGUgRE5TIG5hbWVzcGFjZScodGVzdDogVGVzdCkge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGNOZXR3b3JrKHN0YWNrLCAnTXlWcGMnKTtcblxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IG5ldyBzZXJ2aWNlZGlzY292ZXJ5LlByaXZhdGVEbnNOYW1lc3BhY2Uoc3RhY2ssICdNeU5hbWVzcGFjZScsIHtcbiAgICAgIG5hbWU6ICdwcml2YXRlJyxcbiAgICAgIHZwY1xuICAgIH0pO1xuXG4gICAgbmFtZXNwYWNlLmNyZWF0ZVNlcnZpY2UoJ015U2VydmljZScsIHtcbiAgICAgIG5hbWU6ICdzZXJ2aWNlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnc2VydmljZSBkZXNjcmlwdGlvbicsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6U2VydmljZURpc2NvdmVyeTo6UHJpdmF0ZURuc05hbWVzcGFjZScsIHtcbiAgICAgIE5hbWU6IFwicHJpdmF0ZVwiXG4gICAgfSkpO1xuXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6U2VydmljZURpc2NvdmVyeTo6U2VydmljZScsIHtcbiAgICAgIERlc2NyaXB0aW9uOiBcInNlcnZpY2UgZGVzY3JpcHRpb25cIixcbiAgICAgIERuc0NvbmZpZzoge1xuICAgICAgICBEbnNSZWNvcmRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgVFRMOiA2MCxcbiAgICAgICAgICAgIFR5cGU6IFwiQVwiXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBOYW1lc3BhY2VJZDoge1xuICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICBcIk15TmFtZXNwYWNlRDBCQjg1NThcIixcbiAgICAgICAgICAgIFwiSWRcIlxuICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgUm91dGluZ1BvbGljeTogXCJNVUxUSVZBTFVFXCJcbiAgICAgIH0sXG4gICAgICBOYW1lOiBcInNlcnZpY2VcIixcbiAgICAgIE5hbWVzcGFjZUlkOiB7XG4gICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgXCJNeU5hbWVzcGFjZUQwQkI4NTU4XCIsXG4gICAgICAgICAgXCJJZFwiXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9KSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcbn07XG4iXX0=